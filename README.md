Docker Image with BAGEL
-----------------------

First we have to build the docker image. In this step the required libraries are
installed on top of the ubuntu:latest base image and the latest version of BAGEL is
pulled from github and is compiled:

~~~bash
docker build --tag quack-quack/bagel:latest .
~~~

To test the image we compute the Hartree-Fock energy of fluoric acid.
Since the entrypoint is BAGEL, the command below is equivalent to running
`BAGEL hf_svp_hf.json`, which writes the output to stdout:

~~~bash
docker run -w /tests --rm -i -t quack-quack/bagel:latest   hf_svp_hf.json
~~~

To log into the container and inspect it from the inside interactively,
the default entry point has to be replaced by a bash shell:

~~~bash
docker run --entrypoint /bin/bash --rm -it quack-quack/bagel:latest
~~~


Example
-------
The following steps run a CASSCF/svp calculation on the water molecule.
The JSON input file and a bash script for running all steps can be found in `examples/casscf`.

~~~bash
cd examples/casscf
~~~

`h2o_svg_cas.json` contains the geometry and the details of the calculation:

~~~json
{ "bagel" :
  [
      {
	  "title" : "molecule",
	  "basis" : "svp",
	  "df_basis" : "tzvpp-jkfit",
	  "angstrom" : "false",
	  "thresh_overlap" : 1e-10,
	  "geometry" : [
	      { "atom" : "O", "xyz" : [ 0.00, 0.00, -0.00]},
	      { "atom" : "H", "xyz" : [ 1.43, 0.00,  0.95]},
	      { "atom" : "H", "xyz" : [-1.43, 0.00,  0.95]}
	  ]
      },
      
      {
	  "title" : "hf"
      },
      
      {
	  "title" : "casscf",
	  "nact" : 5,
	  "nclosed" : 2
      },
      
      {
	  "title" : "print",
	  "file"  : "orbitals.molden",
	  "orbitals" : true
      }
  ]
}
~~~

1) Create a container named `bagel-engine` with required resources.

  ~~~bash
  docker container create \
    --name bagel-engine \
    --mount type=tmpfs,destination=/scratch \
    --cpus 2 --memory 6Gb \
      quack-quack/bagel:latest
  ~~~

2) Copy the input script describing the calculation to the container.

  ~~~bash
  docker container cp  \
     h2o_svp_cas.json bagel-engine:/input.json
  ~~~

3) Perform the calculation, the container does the heavy lifting.
  The output generated by BAGEL is written to stdout.

  ~~~bash
  docker container start \
     -a bagel-engine
  ~~~

  The output should 

4) The CASSCF orbitals were written to the file '/orbitals.molden'.
  If we are interested in this file, we have to copy it back before
  deleting the container.

  ~~~bash
  docker container cp \
     bagel-engine:/orbitals.molden  /tmp/orbitals.molden
  ~~~

5) Finally the container is destroyed and all resources are relased.

  ~~~bash
  docker container rm bagel-engine
  ~~~
